<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maestro Extension - Setings</title>
    <link rel="stylesheet" href="../external/bootstrap.min.css">
    <link rel="stylesheet" href="../external/bootstrap-icons.css">
    <link rel="stylesheet" href="../external/bootstrap-table.min.css">
</head>

<body>
    <div class="container">
        <h1 class="my-2">Maestro Extension - Setup</h1>

        <div class="accordion" id="headerAccordion">
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                        <p class="h5">
                            <img src="info-circle.svg" alt="Info" width="20" height="20">
                            To Make a Macro
                        </p>
                    </button>
                </h2>
                <div id="collapseOne" class="accordion-collapse collapse p-2" data-bs-parent="#headerAccordion">

                    <ol>
                        <li>Before you start modifying, click the "Backup Now" button below to take a snapshot
                            backup of
                            all
                            fixtures in the current stage.</li>
                        <li>Go to the <a id="controlPageLink" target="_blank">Control Page</a> Page on the Stages
                            tab.
                        </li>
                        <li>Set all the toggles the way you want them, for each fixture you want to include in the
                            Macro.
                        </li>
                        <li>Come back to this page and select the fixtures you want to include in your Macro.</li>
                        <li>Click "Add Macro" to create it.</li>
                        <li>Once you have created the macros you can at any time click Restore below to restore all
                            the
                            fixtures back to their normal state before you began.</li>
                    </ol>
                    <p>To use the Macro:</p>
                    <ol>
                        <li>Use it to set the toggles to the stored state.</li>
                        <li>Clear the Macro to revert all toggles to the previous state.</li>
                    </ol>
                    <p class="text-danger font-weight-bold">Remember to back up your Stage and Fixtures before
                        testing
                        this
                        feature for your own security.
                    </p>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseThree" aria-expanded="true" aria-controls="collapseThree">
                        <p class="h5">
                            <img src="gear.svg" alt="Info" width="20" height="20">
                            Backup & Restore
                        </p>
                    </button>
                </h2>
                <div id="collapseThree" class="accordion-collapse collapse m-5" data-bs-parent="#headerAccordion">
                    <h6>
                        Backup Now, will create a Snapshot of the currently loaded stage, all settings in this page and
                        store it locally.<br>
                        You can download the Config which *includes* the Fixture Backup and all settings in this
                        page.<br>
                        Restore can be used to upload the earlier downloaded Config file.<br>
                        If you restore a config which contains a Fixture Backup, it will overwrite the current stage's
                        fixture settings!<br>
                        If you're not sure, go to Stages and Download Stage from the Maestro which will give you a
                        backup
                        of the current stage before you import a config and overwrite the fixtures.
                    </h6>
                    <i>Please note. You can import a file from a different stage, but it will fail if the fixtures
                        do not match.</i>
                    <br><br>
                    <div class="my-3">
                        <button class="btn btn-warning" id="backupFixtures">Backup Now</button>
                        <button class="btn btn-info" id="downloadConfig">Download Config</button>
                        <button class="btn btn-info" id="restoreConfig">Restore Config</button>
                        <span class="fst-italic me-2">Last backup date: <span id="backupDate"></span></span>
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseTwo" aria-expanded="true" aria-controls="collapseTwo">
                        <p class="h5">
                            <img src="gear.svg" alt="Info" width="20" height="20">
                            Autofog Setup
                        </p>
                    </button>
                </h2>
                <div id="collapseTwo" class="accordion-collapse collapse m-5" data-bs-parent="#headerAccordion">
                    <h5>Autofog can be also switched on/off from the Icon Menu in the Chrome toolbar.</h5>
                    <i>These switches are live edits, and will take effect immediately</i><br>
                    <i>
                        Activity trigger depends on the Audio Activity Level hitting the minimum peak you specify.<br>
                        The Duration is how long the Fog button will be pressed.<br>
                        The Interval is the minimum time between each execution of the Autofog.<br>
                        Some music may have a lot of activity and it would trigger too many fog blasts, this interval
                        helps you avoid this.
                    </i>
                    <br><br>
                    <div class="row">
                        <div class="form-check form-switch col-auto">
                            <input class="form-check-input" type="checkbox" id="autoFogEnabled">
                            <label class="form-check-label" for="autoFogEnabled">Enabled (Global Switch)</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-check form-switch col-auto">
                            <input class="form-check-input" type="checkbox" id="autoFogOnActivityPeak">
                            <label class="form-check-label" for="autoFogOnActivityPeak">Autofog on Audio Activity
                                Peak (minimum 1 minute between executions)</label>
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col-auto">
                            Fog Trigger(% Activity) <input type="number" min="80" max="99" style="width:70px;"
                                class="form-control" id="autoFogOnActivityPeakPercent">
                        </div>
                        <div class="col-auto">
                            Fog Duration(In Seconds) <input type="number" min="1" max="30" style="width:70px;"
                                class="form-control" id="autoFogOnActivityPeakDuration">
                        </div>
                        <div class="col-auto">
                            Minimum Interval(In Minutes) <input type="number" min="1" max="30" style="width:70px;"
                                class="form-control" id="autoFogOnActivityPeakInterval">
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-check form-switch col-auto">
                            <input class="form-check-input" type="checkbox" id="autoFogOnTimer">
                            <label class="form-check-label" for="autoFogOnTimer">Autofog On Timer(1-15 Mins)</label>
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col-auto">
                            Fog Timer(In Minutes) <input type="number" min="1" max="15" style="width:70px;"
                                class="form-control" id="fogTimer">

                        </div>
                        <div class="col-auto">
                            Fog Duration(In Seconds) <input type="number" min="1" max="30" style="width:70px;"
                                class="form-control" id="fogTimerDuration">

                        </div>
                    </div>
                </div>
            </div>
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapseFour" aria-expanded="true" aria-controls="collapseFour">
                        <p class="h5">
                            <img src="gear.svg" alt="Info" width="20" height="20">
                            AutoStrobe & AutoEffect Setup
                        </p>
                    </button>
                </h2>
                <div id="collapseFour" class="accordion-collapse collapse m-5" data-bs-parent="#headerAccordion">
                    <div class="my-3">
                        <h5>The Strobe and Effect can be triggered based on audio Activity Level.</h5>
                        <i>These switches are live edits, and will take effect immediately</i><br>
                        <i>
                            Activity trigger depends on the Audio Activity Level hitting the minimum peak you
                            specify.<br>
                            The Duration is how long the Strobe/Effect button will be pressed.<br>
                            The Interval is the minimum time between each execution of the Strobe/Effect.<br>
                            Some music may have a lot of activity and it would trigger too many events, the interval
                            helps you avoid this.
                        </i>
                        <br><br>
                        <div class="row">
                            <div class="form-check form-switch col-auto">
                                <input class="form-check-input" type="checkbox" id="autoStrobeEnabled">
                                <label class="form-check-label" for="autoStrobeEnabled">Auto Strobe</label>
                            </div>
                        </div>
                        <div class="row my-3">
                            <div class="col-auto">
                                Strobe Threshold(% Activity) <input type="number" min="80" max="99" style="width:70px;"
                                    class="form-control" id="autoStrobeOnActivityPeakPercent">
                            </div>
                            <div class="col-auto">
                                Strobe Duration(In Seconds) <input type="number" min="1" max="30" style="width:70px;"
                                    class="form-control" id="autoStrobeOnActivityPeakDuration">
                            </div>
                            <div class="col-auto">
                                Minimum Interval(In Minutes) <input type="number" min="1" max="30" style="width:70px;"
                                    class="form-control" id="autoStrobeOnActivityPeakInterval">
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-check form-switch col-auto">
                                <input class="form-check-input" type="checkbox" id="autoEffectsEnabled">
                                <label class="form-check-label" for="autoEffectsEnabled">Auto Effect</label>
                            </div>
                        </div>
                        <div class="row my-3">
                            <div class="col-auto">
                                Effect Threshold(% Activity) <input type="number" min="80" max="99" style="width:70px;"
                                    class="form-control" id="autoEffectsOnActivityPeakPercent">
                            </div>
                            <div class="col-auto">
                                Effect Duration(In Seconds) <input type="number" min="1" max="30" style="width:70px;"
                                    class="form-control" id="autoEffectsOnActivityPeakDuration">
                            </div>
                            <div class="col-auto">
                                Minimum Interval(In Minutes) <input type="number" min="1" max="30" style="width:70px;"
                                    class="form-control" id="autoEffectsOnActivityPeakInterval">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="my-5"></div>

        <h2 class="mt-3">Macros</h2>

        <table id="macros" class="table my-2">
            <thead class="table-light">
                <tr>
                    <th data-field="name">Macro Name</th>
                    <th data-field="length">Number of Fixtures</th>
                    <th width="100" data-width="100"></th>
                    <th width="100" data-width="100"></th>
                    <th width="100" data-width="100"></th>
                </tr>
                <tr>
                    <td colspan="5">No macros defined yet.</td>
                </tr>

            </thead>
        </table>

        <div class="my-4"></div>

        <div class="my-2 bg-light p-2 rounded" width="100%">

            <div>
                <p class="h5">Enable Strobe Triggering</p>
                <p style="text-align: justify;">
                <p></p>
                For fixtures that do not respond to the MaestroDMX Strobe function, you can set specific parameters:
                the Shutter Open value, representing the normal open state for the Shutter or Strobe channel of the
                fixture, and a Strobe value. The Strobe value should correspond to the strobe function of the fixture.
                You can fine-tune the Strobe value according to the DMX values specified in the fixture's manual,
                enabling adjustment for strobe speed.
                </p>
                <div class="my-1"></div>
                <p>
                    Fixtures configured with both Shutter and Strobe values can be triggered using the Strobe button,
                    provided the extension identifies a compatible Shutter or Strobe channel within the fixture profile.
                </p>
            </div>
        </div>

        <h2 class="mt-3">Fixtures</h2>

        <table id="fixtures" class="table my-1">
            <thead class="table-light">
                <tr>
                    <th data-field="pantilt"></th>
                    <th data-field="name">Fixture Name</th>
                    <th data-field="fixtureGroup">Fixture Group</th>
                    <th data-field="fixturePosition">Arrangement</th>
                    <th data-field="active">Active</th>
                    <th data-field="shutter" width="50" data-width="50">Shutter Open</th>
                    <th data-field="strobe" width="50" data-width="50">Strobe</th>
                    <th data-field="ignore"></th>
                    <th data-field="select"></th>
                </tr>
            </thead>
        </table>
        <div class="float-end my-2">
            <button id="addMacro" class="btn btn-primary">Add Macro</button>
        </div>

        <h2 class="mt-3">Stages</h2>

        <table id="stages" class="table my-1">
            <thead class="table-light">
                <tr>
                    <th data-field="name" data-sortable="true">Stage Name</th>
                    <th data-field="fixtures" data-sortable="true">Fixture</th>
                    <th data-field="active" data-sortable="true">Active</th>
                </tr>
            </thead>
        </table>
        <div class="my-5"></div>
        <!-- Modal Pan/Tilt Finder -->
        <div id="panTiltFinder" class="modal fade" role="dialog">
            <div class="modal-dialog">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Pan/Tilt - Position Finder</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            These settings are LIVE EFFECTS saved to the fixture automatically.
                            To revert to 0-255, click "Reset".
                        </p>
                        <div class="my-3" style="max-width: 500px;">
                            <table class="table">
                                <tr>
                                    <td width="50">Pan:</td>
                                    <td>
                                        <input type="range" class="form-range" min="0" max="255" steps="1" id="panRange"
                                            value="0">
                                    </td>
                                    <td width="30">
                                        <input type="number" min="0" max="255" style="width:70px;" class="form-control"
                                            id="panRangeVal">
                                    </td>
                                </tr>
                                <tr>
                                    <td width="50">Tilt:</td>
                                    <td><input type="range" class="form-range" min="0" max="255" steps="1"
                                            id="tiltRange" value="0">
                                    </td>
                                    <td width="30">
                                        <input type="number" min="0" max="255" style="width:70px;" class="form-control"
                                            id="tiltRangeVal">
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="my-2">
                            <p id="fixtureName" class="h5 text-center"></p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" id="panTiltReset">Reset</button>
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>

            </div>
        </div>
        <!-- Modal Stage Reloaded -->
        <div id="modalStageReloaded" class="modal fade" role="dialog">
            <div class="modal-dialog">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Stage Changed</h4>
                    </div>
                    <div class="modal-body">
                        <p class="h5 text-danger">
                            You must reload the page to see the changes.
                        </p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="btnReloadPage">Reload Now</button>
                    </div>
                </div>

            </div>
        </div>
        <!-- Modal No Connection -->
        <div id="modalDown" class="modal fade" role="dialog" data-bs-backdrop="static" data-bs-keyboard="false">
            <div class="modal-dialog">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">
                            Maestro Offline
                        </h4>
                    </div>
                    <div class="modal-body">
                        <p class="h5 text-danger">
                            Cannot connect to Maestro.<br>
                            Please check your connection and try again.
                        </p>
                    </div>
                    <div class="modal-footer">
                        <img src="connection.svg" alt="Connection Lost" width="60" height="60">
                    </div>
                </div>

            </div>
        </div>
    </div>
    <script src="../external/jquery.min.js"></script>
    <script src="../external/bootstrap.bundle.min.js"></script>
    <script src="../external/bootstrap-table.min.js"></script>
    <script src="../external/lodash.min.js"></script>
    <script src="../inject/js/globals.js"></script>
    <script src="../inject/js/settings.js"></script>
</body>

</html>