<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maestro Extension - Setings</title>
    <link rel="stylesheet" href="../external/bootstrap.min.css">
    <link rel="stylesheet" href="../external/bootstrap-icons.css">
    <link rel="stylesheet" href="../external/bootstrap-table.min.css">
    <link rel="stylesheet" href="/src/inject/css/settings.css">
</head>

<body>
    <div class="container">
        <h1 class="my-2">Maestro Extension - Setup</h1>
        <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item" role="presentation">
                <a class="nav-link active" id="simple-tab-0" data-bs-toggle="tab" href="#tabpanel-info" role="tab"
                    aria-controls="tabpanel-info" aria-selected="true">
                    <img src="info-circle.svg" alt="Info" width="20" height="20">
                    Instructions
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="simple-tab-1" data-bs-toggle="tab" href="#tabpanel-backup" role="tab"
                    aria-controls="tabpanel-backup" aria-selected="false">
                    <img src="/src/img/database-fill-check.svg" alt="Info" width="20" height="20">
                    Backup & Restore
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="simple-tab-2" data-bs-toggle="tab" href="#tabpanel-fog" role="tab"
                    aria-controls="tabpanel-fog" aria-selected="false">
                    <img src="/src/img/cloud-haze.svg" alt="Info" width="20" height="20">
                    Auto Fog
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="simple-tab-3" data-bs-toggle="tab" href="#tabpanel-strobe" role="tab"
                    aria-controls="tabpanel-strobe" aria-selected="false">
                    <img src="/src/img/lightbulb.svg" alt="Info" width="20" height="20">
                    <img src="/src/img/fire.svg" alt="Info" width="20" height="20">
                    Auto Strobe & Effects
                </a>
            </li>
        </ul>

        <div class="tab-content pt-5">
            <div class="tab-pane active" id="tabpanel-info" role="tabpanel" aria-labelledby="simple-tab-0">
                <ol>
                    <li>For your convenience, before you start modifying, take a backup of your Stage, from the MaestroDMX control panel,
                        from this extension, you can take a backup of all the fixture settings and macros via the Backup & Restore tab.</li>
                    <li>Go to the <a id="controlPageLink" target="_blank">Control Page</a> Page on the Stages
                        tab.
                    </li>
                    <li>Set all the toggles the way you want them, for each fixture you want to include in the
                        Macro.
                    </li>
                    <li>Come back to this page and select the fixtures on the Fixtures tab below you want to include in
                        your Macro.</li>
                    <li>Click "Add Macro" to create it.</li>
                    <li>Once you have created the macros you can at any time click Restore below to restore all
                        the
                        fixtures back to their normal state before you began.</li>
                </ol>
                <p>To use the Macro:</p>
                <ol>
                    <li>Use it to set the toggles to the stored state.</li>
                    <li>Clear the Macro to revert all toggles to the previous state.</li>
                    <li>Remember - the macro changes the Fixture Settings, not the Show Cue.</li>
                </ol>
                <p class="text-danger font-weight-bold">Remember to back up your Stage and Fixtures before
                    testing
                    this
                    feature for your own security.
                </p>
            </div>

            <div class="tab-pane" id="tabpanel-backup" role="tabpanel" aria-labelledby="simple-tab-1">
                <p>
                    Backup Now, will create a Snapshot of the currently loaded stage, all settings in this page and
                    store it locally.<br>
                    You can download the Config which *includes* the Fixture Backup and all settings in this
                    page.<br>
                    Restore can be used to upload the earlier downloaded Config file.<br>
                    If you restore a config which contains a Fixture Backup, it will overwrite the current stage's
                    fixture settings!<br>
                    If you're not sure, go to Stages and Download Stage from the Maestro which will give you a
                    backup
                    of the current stage before you import a config and overwrite the fixtures.
                </p>
                <i>Please note. You can import a file from a different stage, but it will fail if the fixtures
                    do not match.</i>
                <br><br>
                <div class="my-3">
                    <button class="btn btn-warning" id="backupFixtures">Backup Now</button>
                    <button class="btn btn-info" id="downloadConfig">Download Config</button>
                    <button class="btn btn-info" id="restoreConfig">Restore Config</button>
                    <span class="fst-italic me-2">Last backup date: <span id="backupDate"></span></span>
                </div>
            </div>

            <div class="tab-pane" id="tabpanel-fog" role="tabpanel" aria-labelledby="simple-tab-2">
                <h5>Autofog can be also switched on/off from the Icon Menu in the Chrome toolbar.</h5>
                <i>These switches are live edits, and will take effect immediately</i><br>
                <i>
                    Activity trigger depends on the Audio Activity Level hitting the minimum peak you specify.<br>
                    The Duration is how long the Fog button will be pressed.<br>
                    The Interval is the minimum time between each execution of the Autofog.<br>
                    Some music may have a lot of activity and it would trigger too many fog blasts, this interval
                    helps you avoid this.<br>
                    You can activate both Fog on Timer, and Fog on Activity Peak, but only one will be executed at a
                    time and they will both respect each others interval settings.

                </i>
                <br><br>
                <div class="mx-3">
                    <div class="row">
                        <div class="form-check form-switch col-auto">
                            <input class="form-check-input" type="checkbox" id="autoFogEnabled">
                            <label class="form-check-label" for="autoFogEnabled">Enabled (Global Switch)</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-check form-switch col-auto">
                            <input class="form-check-input" type="checkbox" id="autoFogOnActivityPeak">
                            <label class="form-check-label" for="autoFogOnActivityPeak">Autofog on Audio Activity
                                Peak (minimum 1 minute between executions)</label>
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col-auto">
                            Fog Trigger(% Activity) <input type="number" min="80" max="99" style="width:70px;"
                                class="form-control" id="autoFogOnActivityPeakPercent">
                        </div>
                        <div class="col-auto">
                            Fog Duration(In Seconds) <input type="number" min="1" max="30" style="width:70px;"
                                class="form-control" id="autoFogOnActivityPeakDuration">
                        </div>
                        <div class="col-auto">
                            Minimum Interval(In Minutes) <input type="number" min="1" max="30" style="width:70px;"
                                class="form-control" id="autoFogOnActivityPeakInterval">
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-check form-switch col-auto">
                            <input class="form-check-input" type="checkbox" id="autoFogOnTimer">
                            <label class="form-check-label" for="autoFogOnTimer">Autofog On Timer(1-15 Mins)</label>
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col-auto">
                            Fog Timer(In Minutes) <input type="number" min="1" max="15" style="width:70px;"
                                class="form-control" id="fogTimer">

                        </div>
                        <div class="col-auto">
                            Fog Duration(In Seconds) <input type="number" min="1" max="30" style="width:70px;"
                                class="form-control" id="fogTimerDuration">

                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane" id="tabpanel-strobe" role="tabpanel" aria-labelledby="simple-tab-3">

                <h5>The Strobe and Effect can be triggered based on audio Activity Level.</h5>
                <i>These switches are live edits, and will take effect immediately</i><br>
                <i>
                    Activity trigger depends on the Audio Activity Level hitting the minimum peak you
                    specify.<br>
                    The Duration is how long the Strobe/Effect button will be pressed.<br>
                    The Interval is the minimum time between each execution of the Strobe/Effect.<br>
                    Some music may have a lot of activity and it would trigger too many events, the interval
                    helps you avoid this.
                </i>
                <br><br>
                <div class="mx-3">
                    <div class="row">
                        <div class="form-check form-switch col-auto">
                            <input class="form-check-input" type="checkbox" id="autoStrobeEnabled">
                            <label class="form-check-label" for="autoStrobeEnabled">Auto Strobe</label>
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col-auto">
                            Strobe Threshold(% Activity) <input type="number" min="80" max="99" style="width:70px;"
                                class="form-control" id="autoStrobeOnActivityPeakPercent">
                        </div>
                        <div class="col-auto">
                            Strobe Duration(In Seconds) <input type="number" min="1" max="30" style="width:70px;"
                                class="form-control" id="autoStrobeOnActivityPeakDuration">
                        </div>
                        <div class="col-auto">
                            Minimum Interval(In Minutes) <input type="number" min="1" max="30" style="width:70px;"
                                class="form-control" id="autoStrobeOnActivityPeakInterval">
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-check form-switch col-auto">
                            <input class="form-check-input" type="checkbox" id="autoEffectsEnabled">
                            <label class="form-check-label" for="autoEffectsEnabled">Auto Effect</label>
                        </div>
                    </div>
                    <div class="row my-3">
                        <div class="col-auto">
                            Effect Threshold(% Activity) <input type="number" min="80" max="99" style="width:70px;"
                                class="form-control" id="autoEffectsOnActivityPeakPercent">
                        </div>
                        <div class="col-auto">
                            Effect Duration(In Seconds) <input type="number" min="1" max="30" style="width:70px;"
                                class="form-control" id="autoEffectsOnActivityPeakDuration">
                        </div>
                        <div class="col-auto">
                            Minimum Interval(In Minutes) <input type="number" min="1" max="30" style="width:70px;"
                                class="form-control" id="autoEffectsOnActivityPeakInterval">
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="my-5"></div>

        <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item" role="presentation">
                <a class="nav-link active" id="simple-tab-4" data-bs-toggle="tab" href="#tabpanel-macros" role="tab"
                    aria-controls="tabpanel-macros" aria-selected="true">
                    <img src="/src/img/gear.svg" alt="Info" width="20" height="20">
                    Macros
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="simple-tab-5" data-bs-toggle="tab" href="#tabpanel-fixtures" role="tab"
                    aria-controls="tabpanel-fixtures" aria-selected="false">
                    <img src="/src/img/projector.svg" alt="Info" width="20" height="20">
                    Fixtures
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="simple-tab-6" data-bs-toggle="tab" href="#tabpanel-stages" role="tab"
                    aria-controls="tabpanel-stages" aria-selected="false">
                    <img src="/src/img/shop-window.svg" alt="Info" width="20" height="20">
                    Stages
                </a>
            </li>
        </ul>

        <div class="tab-content">
            <h2 class="mt-3"></h2>
            <div class="tab-pane active" id="tabpanel-macros" role="tabpanel" aria-labelledby="simple-tab-4">
                <div>
                    <p class="h6">
                        <img src="info-circle.svg" alt="Info" width="20" height="20">
                        <i>You can create macros via the Fixtures Tab</i>
                    </p>
                </div>
                <table id="macros" class="table my-2">
                    <thead class="table-light">
                        <tr>
                            <th data-field="name" width="200" data-width="200">Macro Name</th>
                            <th data-field="length" width="50" data-width="50">#</th>
                            <th data-field="length">Fixtures Affected</th>
                            <th width="100" data-width="100"></th>
                            <th width="100" data-width="100"></th>
                            <th width="100" data-width="100"></th>
                        </tr>
                        <tr>
                            <td colspan="5">No macros defined yet.</td>
                        </tr>

                    </thead>
                </table>
            </div>
            <div class="tab-pane" id="tabpanel-fixtures" role="tabpanel" aria-labelledby="simple-tab-5">
                <div>
                    <p class="h6">Enable Strobe Triggering</p>

                    If the MaestroDMX Strobe function doesn't work, and your fixture has a dedicated Strobe or Shutter
                    channel,
                    you can set specific parameters here to to fix it.
                    <br>
                    <ol>
                        <li>
                            Set "Shutter Open" value, representing the normal open state for the Shutter or Strobe
                        </li>
                        <li>
                            Set "Strobe" value, corresponding to the strobe function of the fixture. You can fine-tune
                            the Strobe value according to the DMX values specified in the fixture's manual, enabling
                            adjustment for strobe speed.
                        </li>
                    </ol>
                    Once the parameters are set correctly, when you use the "Strobe" button on the footer, or in the
                    Show Page it should cause your fixture to strobe. If it doesn't work, try adjusting the values or
                    refreshing the main MaestroDMX page to ensure you have the latest config.
                </div>

                <table id="fixtures" class="table">
                    <thead class="table-light">
                        <tr>
                            <th data-field="pantilt"></th>
                            <th data-field="name">Fixture Name</th>
                            <th data-field="fixtureGroup">Fixture Group</th>
                            <th data-field="fixturePosition">Arrangement</th>
                            <th data-field="active">Active</th>
                            <th data-field="shutter" width="50" data-width="50">Shutter Open</th>
                            <th data-field="strobe" width="50" data-width="50">Strobe</th>
                            <th data-field="ignore"></th>
                            <th data-field="select"></th>
                        </tr>
                    </thead>
                </table>
                <div style="width:100%;text-align: right;" class="my-2">
                    <button id="addMacro" class="btn btn-primary">Add Macro</button>
                </div>
            </div>

            <div class="tab-pane" id="tabpanel-stages" role="tabpanel" aria-labelledby="simple-tab-6">
                <h2 class="mt-3"></h2>

                <table id="stages" class="table my-1">
                    <thead class="table-light">
                        <tr>
                            <th data-field="name" data-sortable="true">Stage Name</th>
                            <th data-field="fixtures" data-sortable="true">Fixture</th>
                            <th data-field="active" data-sortable="true">Active</th>
                        </tr>
                    </thead>
                </table>
                <div class="my-5"></div>
            </div>
        </div>
        <div class="my-5"></div>
        <!-- Modal Pan/Tilt Finder -->
        <div id="panTiltFinder" class="modal fade" role="dialog">
            <div class="modal-dialog">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Pan/Tilt - Position Finder</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            These settings are LIVE EFFECTS saved to the fixture automatically.
                            To revert to 0-255, click "Reset".
                        </p>
                        <div class="my-3" style="max-width: 500px;">
                            <table class="table">
                                <tr>
                                    <td width="50">Pan:</td>
                                    <td>
                                        <input type="range" class="form-range" min="0" max="255" steps="1" id="panRange"
                                            value="0">
                                    </td>
                                    <td width="30">
                                        <input type="number" min="0" max="255" style="width:70px;" class="form-control"
                                            id="panRangeVal">
                                    </td>
                                </tr>
                                <tr>
                                    <td width="50">Tilt:</td>
                                    <td><input type="range" class="form-range" min="0" max="255" steps="1"
                                            id="tiltRange" value="0">
                                    </td>
                                    <td width="30">
                                        <input type="number" min="0" max="255" style="width:70px;" class="form-control"
                                            id="tiltRangeVal">
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="my-2">
                            <p id="fixtureName" class="h5 text-center"></p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" id="panTiltReset">Reset</button>
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>

            </div>
        </div>
        <!-- Modal Stage Reloaded -->
        <div id="modalStageReloaded" class="modal fade" role="dialog">
            <div class="modal-dialog">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Stage Changed</h4>
                    </div>
                    <div class="modal-body">
                        <p class="h5 text-danger">
                            You must reload the page to see the changes.
                        </p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="btnReloadPage">Reload Now</button>
                    </div>
                </div>

            </div>
        </div>
        <!-- Modal No Connection -->
        <div id="modalDown" class="modal fade" role="dialog" data-bs-backdrop="static" data-bs-keyboard="false">
            <div class="modal-dialog">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">
                            Maestro Offline
                        </h4>
                    </div>
                    <div class="modal-body">
                        <p class="h5 text-danger">
                            Cannot connect to Maestro.<br>
                            Please check your connection and try again.
                        </p>
                    </div>
                    <div class="modal-footer">
                        <img src="connection.svg" alt="Connection Lost" width="60" height="60">
                    </div>
                </div>

            </div>
        </div>
    </div>
    <script src="../external/jquery.min.js"></script>
    <script src="../external/bootstrap.bundle.min.js"></script>
    <script src="../external/bootstrap-table.min.js"></script>
    <script src="../external/lodash.min.js"></script>
    <script src="../inject/js/globals.js"></script>
    <script src="../inject/js/settings.js"></script>
</body>

</html>